<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>–†–ê–ó–£–ú ‚Äî –¥–µ–º–æ –ª–æ–≥–æ–ø–µ–¥–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä</title>
<style>
body { font-family: Arial,sans-serif; background: linear-gradient(180deg,#eef2ff,#ffffff); margin:0; padding:16px;}
header{text-align:center;margin-bottom:16px;}
.logo{max-width:140px;margin:0 auto 8px;display:block;}
.role-btn{width:100%;padding:12px;margin:6px 0;border:none;border-radius:14px;font-size:16px;background:#6366f1;color:#fff;cursor:pointer;}
.card{background:#fff;border-radius:16px;padding:16px;margin-bottom:12px;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
.progress{background:#e5e7eb;border-radius:10px;overflow:hidden;}
.progress div{background:#22c55e;height:10px;}
.hidden{display:none;}
textarea,input,select{width:100%;padding:8px;margin-top:6px;border-radius:8px;border:1px solid #ccc;}
.avatar{width:40px;height:40px;border-radius:50%;margin-right:8px;vertical-align:middle;}
.flex{display:flex;align-items:center;justify-content:space-between;}
.attendance{cursor:pointer;font-weight:bold;}
.attendance.attended{color:green;}
.schedule-table{width:100%;border-collapse:collapse;margin-bottom:16px;}
.schedule-table th, .schedule-table td{border:1px solid #ccc;padding:6px;text-align:center;}
.float-right{float:right;}
</style>
</head>
<body>

<header>
<img src="logo.png.jpg" class="logo">
<h1>–†–ê–ó–£–ú</h1>
<p>–õ–æ–≥–æ–ø–µ–¥–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä ‚Ä¢ –ü–µ—Ç–µ—Ä–≥–æ—Ñ</p>
<p>üìû 8 913 450-30-29<br>üìç –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç 60–õ, 2 —ç—Ç–∞–∂</p>
</header>

<div id="roles">
  <button class="role-btn" onclick="showParent()">–Ø —Ä–æ–¥–∏—Ç–µ–ª—å</button>
  <button class="role-btn" onclick="showSpeech()">–Ø –ª–æ–≥–æ–ø–µ–¥</button>
  <button class="role-btn" onclick="showAdmin()">–Ø –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
</div>

<div id="parent" class="hidden"></div>
<div id="speech" class="hidden"></div>
<div id="admin" class="hidden"></div>

<script>
// ======== –î–ê–ù–ù–´–ï –î–ï–ú–û ========
const data=JSON.parse(localStorage.getItem("razumDemo"))||{
  currentChildId:1,
  currentTherapistId:1,
  children:[
    {id:1,name:"–§—ë–¥–æ—Ä",age:4,avatar:"avatar1.png",therapistId:1,totalLessons:8,attendance:[],tasks:[{id:1,text:"–ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ 10 —Å–ª–æ–≤ —Å–æ –∑–≤—É–∫–æ–º –†",done:false}],comment:""},
    {id:2,name:"–ê–ª–µ–∫—Å–∞–Ω–¥—Ä",age:5,avatar:"avatar2.png",therapistId:1,totalLessons:12,attendance:[],tasks:[],comment:""},
    {id:3,name:"–ê—Ä—Ç—ë–º",age:4,avatar:"avatar3.png",therapistId:1,totalLessons:4,attendance:[],tasks:[],comment:""},
    {id:4,name:"–ú–∏—Ä–æ—Å–ª–∞–≤–∞",age:6,avatar:"avatar4.png",therapistId:1,totalLessons:8,attendance:[],tasks:[],comment:""},
    {id:5,name:"–Ø—Å—è",age:5,avatar:"avatar5.png",therapistId:1,totalLessons:12,attendance:[],tasks:[],comment:""},
    {id:6,name:"–í–ª–∞–¥–∏–º–∏—Ä",age:7,avatar:"avatar6.png",therapistId:1,totalLessons:4,attendance:[],tasks:[],comment:""},
    {id:7,name:"–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞",age:4,avatar:"avatar7.png",therapistId:1,totalLessons:8,attendance:[],tasks:[],comment:""},
    {id:8,name:"–ê–ª–µ–∫—Å–µ–π",age:6,avatar:"avatar8.png",therapistId:1,totalLessons:12,attendance:[],tasks:[],comment:""},
    {id:9,name:"–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω",age:5,avatar:"avatar9.png",therapistId:1,totalLessons:4,attendance:[],tasks:[],comment:""},
    {id:10,name:"–ü—ë—Ç—Ä",age:6,avatar:"avatar10.png",therapistId:1,totalLessons:8,attendance:[],tasks:[],comment:""},
    {id:11,name:"–ï–ª–∏–∑–∞–≤–µ—Ç–∞",age:7,avatar:"avatar11.png",therapistId:1,totalLessons:12,attendance:[],tasks:[],comment:""},
    {id:12,name:"–ê–ª—ë–Ω–∞",age:5,avatar:"avatar12.png",therapistId:1,totalLessons:4,attendance:[],tasks:[],comment:""},
    {id:13,name:"–ú–∏—è",age:4,avatar:"avatar13.png",therapistId:1,totalLessons:8,attendance:[],tasks:[],comment:""},
    {id:14,name:"–¢–∞–∏—Ä",age:5,avatar:"avatar14.png",therapistId:1,totalLessons:12,attendance:[],tasks:[],comment:""},
    {id:15,name:"–°—Ç–µ—à–∞",age:6,avatar:"avatar15.png",therapistId:1,totalLessons:4,attendance:[],tasks:[],comment:""},
    {id:16,name:"–õ–µ–æ–Ω–∏–¥",age:7,avatar:"avatar16.png",therapistId:1,totalLessons:8,attendance:[],tasks:[],comment:""},
    {id:17,name:"–°–∞–≤–µ–ª–∏–π",age:4,avatar:"avatar17.png",therapistId:1,totalLessons:12,attendance:[],tasks:[],comment:""},
    {id:18,name:"–ê—Ä–∏–Ω–∞",age:5,avatar:"avatar18.png",therapistId:1,totalLessons:4,attendance:[],tasks:[],comment:""},
    {id:19,name:"–ï–≤–≥–µ–Ω–∏–π",age:6,avatar:"avatar19.png",therapistId:1,totalLessons:8,attendance:[],tasks:[],comment:""},
    {id:20,name:"–í–∞–¥–∏–º",age:7,avatar:"avatar20.png",therapistId:1,totalLessons:12,attendance:[],tasks:[],comment:""},
    {id:21,name:"–Æ–ª–∏—è",age:5,avatar:"avatar21.png",therapistId:1,totalLessons:4,attendance:[],tasks:[],comment:""},
    {id:22,name:"–ö–∏—Ä–∏–ª–ª",age:6,avatar:"avatar22.png",therapistId:1,totalLessons:8,attendance:[],tasks:[],comment:""},
    {id:23,name:"–ó–æ—è",age:7,avatar:"avatar23.png",therapistId:1,totalLessons:12,attendance:[],tasks:[],comment:""},
    {id:24,name:"–ú–∏—Ö–∞–∏–ª",age:4,avatar:"avatar24.png",therapistId:1,totalLessons:4,attendance:[],tasks:[],comment:""},
    {id:25,name:"–î–∞–≤–∏–¥",age:5,avatar:"avatar25.png",therapistId:2,totalLessons:8,attendance:[],tasks:[],comment:""},
    {id:26,name:"–ú–∞–∫—Å–∏–º",age:6,avatar:"avatar26.png",therapistId:2,totalLessons:12,attendance:[],tasks:[],comment:""},
    {id:27,name:"–ú–∞–∫—Å–∏–º",age:7,avatar:"avatar27.png",therapistId:2,totalLessons:4,attendance:[],tasks:[],comment:""},
    {id:28,name:"–ú–∞–∫—Å–∏–º",age:4,avatar:"avatar28.png",therapistId:2,totalLessons:8,attendance:[],tasks:[],comment:""},
    {id:29,name:"–¢–∞—Ç—å—è–Ω–∞",age:5,avatar:"avatar29.png",therapistId:2,totalLessons:12,attendance:[],tasks:[],comment:""},
    {id:30,name:"–ò–ª—å—è",age:6,avatar:"avatar30.png",therapistId:2,totalLessons:4,attendance:[],tasks:[],comment:""},
    {id:31,name:"–ì–ª–µ–±",age:7,avatar:"avatar31.png",therapistId:2,totalLessons:8,attendance:[],tasks:[],comment:""},
    {id:32,name:"–§—ë–¥–æ—Ä",age:5,avatar:"avatar32.png",therapistId:2,totalLessons:12,attendance:[],tasks:[],comment:""},
    {id:33,name:"–ú–∞–π—è",age:6,avatar:"avatar33.png",therapistId:3,totalLessons:8,attendance:[],tasks:[],comment:""}
  ],
  therapists:[
    {id:1,name:"–í–∞—Å—é–∫–æ–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞"},
    {id:2,name:"–ü—Ä–æ–∫–æ–ø–µ–Ω–∫–æ –°–≤–µ—Ç–ª–∞–Ω–∞ –ì–µ–Ω–Ω–∞–¥—å–µ–≤–Ω–∞"},
    {id:3,name:"–°–∞—Ñ—Ä–æ–Ω–æ–≤–∞ –ù–∞—Ç–∞–ª—å—è –ù–∏–∫–æ–ª–∞–µ–≤–Ω–∞"}
  ],
  admins:[{id:1,name:"–í–∞—Å—é–∫–æ–≤ –Æ—Ä–∏–π –°–µ—Ä–≥–µ–µ–≤–∏—á"}]
};

function save(){localStorage.setItem("razumDemo",JSON.stringify(data));}
function hideAll(){["roles","parent","speech","admin"].forEach(id=>document.getElementById(id).classList.add("hidden"));}
function back(){hideAll();document.getElementById("roles").classList.remove("hidden");}
function currentChild(){return data.children.find(c=>c.id===data.currentChildId);}
function getCurrentTherapist(){return data.therapists.find(t=>t.id===data.currentTherapistId);}

// ======== –†–æ–¥–∏—Ç–µ–ª—å ========
function childSelector(){
  return `<select onchange="changeChild(this.value)">
    ${data.children.map(c=>`<option value="${c.id}" ${c.id===data.currentChildId?"selected":""}>${c.name} (${c.age})</option>`).join("")}
  </select>`;
}
function changeChild(id){data.currentChildId=Number(id);save();showParent();}
function showParent(){
  hideAll();
  const c=currentChild();
  const p=document.getElementById("parent");
  const progressPercent=c.tasks.length ? c.tasks.filter(t=>t.done).length/c.tasks.length*100 :0;
  p.innerHTML=childSelector()+`
    <h2>${c.name} (${c.age})</h2>
    <p><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</b> ${c.comment||"‚Äî"}</p>
    <div class="progress"><div style="width:${progressPercent}%"></div></div>
    <p>–û—Å—Ç–∞—Ç–æ–∫ –∑–∞–Ω—è—Ç–∏–π: ${c.totalLessons - c.attendance.length}</p>
    <h3>–ó–∞–¥–∞–Ω–∏—è</h3>
    ${c.tasks.map(t=>`<div><label><input type="checkbox" ${t.done?"checked":""} onchange="toggle(${t.id})">${t.text}</label></div>`).join("")}
    <button class="role-btn" onclick="back()">–ù–∞–∑–∞–¥</button>`;
  p.classList.remove("hidden");
}
function toggle(id){const c=currentChild();const t=c.tasks.find(x=>x.id===id);t.done=!t.done;save();showParent();}

// ======== –õ–æ–≥–æ–ø–µ–¥ ========
function therapistSelector(){
  return `<select onchange="changeTherapist(this.value)">
    ${data.therapists.map(t=>`<option value="${t.id}" ${t.id===data.currentTherapistId?"selected":""}>${t.name}</option>`).join("")}
  </select>`;
}
function changeTherapist(id){data.currentTherapistId=Number(id);save();showSpeech();}
function updateComment(childId,val){const c=data.children.find(c=>c.id===childId);if(c){c.comment=val;save();}}
function addTask(childId){const text=document.getElementById(`taskText${childId}`).value;if(!text)return;const c=data.children.find(c=>c.id===childId);c.tasks.push({id:Date.now(),text,done:false});save();showSpeech();}
function markAttendance(childId){const c=data.children.find(c=>c.id===childId);const today=new Date().toDateString();if(c.attendance.includes(today)){c.attendance=c.attendance.filter(d=>d!==today);}else{c.attendance.push(today);}save();showSpeech();}
function updateScheduleTime(childId,time){const c=data.children.find(c=>c.id===childId);if(c){c.scheduleTime=time;save();}}

function showSpeech(){
  hideAll();
  const s=document.getElementById("speech");
  s.innerHTML="";
  const therapist=getCurrentTherapist();
  s.innerHTML+=therapistSelector();

  const children=data.children.filter(c=>c.therapistId===data.currentTherapistId);
  s.innerHTML+="<h3>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h3>";
  s.innerHTML+="<table class='schedule-table'><tr><th>–í—Ä–µ–º—è</th><th>–†–µ–±–µ–Ω–æ–∫</th><th>–û—Å—Ç–∞—Ç–æ–∫ –∑–∞–Ω—è—Ç–∏–π</th></tr>";
  const defaultTimes=["09:00","10:00","11:00","12:00","13:00","14:00"];
  children.forEach((child,i)=>{if(!child.scheduleTime)child.scheduleTime=defaultTimes[i%defaultTimes.length];
    s.innerHTML+=`<tr><td><select onchange="updateScheduleTime(${child.id}, this.value)">${defaultTimes.map(t=>`<option value="${t}" ${t===child.scheduleTime?"selected":""}>${t}</option>`).join("")}</select></td><td>${child.name}</td><td>${child.totalLessons - child.attendance.length}</td></tr>`});
  s.innerHTML+="</table><br>";

  children.forEach(c=>{
    s.innerHTML+=`
      <div class="card">
        <div class="flex"><img class="avatar" src="${c.avatar}" alt="–ê–≤–∞—Ç–∞—Ä"><b>${c.name} (${c.age})</b> <span class="float-right">–û—Å—Ç–∞—Ç–æ–∫ –∑–∞–Ω—è—Ç–∏–π: ${c.totalLessons - c.attendance.length}</span></div>
        <textarea placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–æ–¥–∏—Ç–µ–ª—é" oninput="updateComment(${c.id}, this.value)">${c.comment}</textarea>
        <h4>–ù–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ</h4>
        <input id="taskText${c.id}" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ">
        <button class="role-btn" onclick="addTask(${c.id})">–î–æ–±–∞–≤–∏—Ç—å</button>
        <h4>–ó–∞–¥–∞–Ω–∏—è</h4>
        ${c.tasks.map(t=>`<div>${t.done?"‚úÖ":"‚ùå"} ${t.text}</div>`).join("")}
        <h4>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h4>
        <span class="attendance ${c.attendance.includes(new Date().toDateString())?"attended":""}" onclick="markAttendance(${c.id})">
          ${c.attendance.includes(new Date().toDateString())?"‚úÖ –ü—Ä–∏—à–µ–ª":"‚ùå –ù–µ –ø—Ä–∏—à–µ–ª"}
        </span>
      </div>`;
  });
  s.innerHTML+="<button class='role-btn' onclick='back()'>–ù–∞–∑–∞–¥</button>";
  s.classList.remove("hidden");
}

// ======== –ê–¥–º–∏–Ω ========
function showAdmin(){
  hideAll();
  const a=document.getElementById("admin");
  a.innerHTML="<h2>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</h2>";
  data.children.forEach(c=>{
    const therapist=data.therapists.find(t=>t.id===c.therapistId);
    const progressPercent=c.tasks.length ? c.tasks.filter(t=>t.done).length/c.tasks.length*100 :0;
    a.innerHTML+=`
      <div class="card">
        <div class="flex"><img class="avatar" src="${c.avatar}" alt="–ê–≤–∞—Ç–∞—Ä"><b>${c.name} (${c.age})</b> - –ª–æ–≥–æ–ø–µ–¥: ${therapist?therapist.name:"‚Äî"} <span class="float-right">–û—Å—Ç–∞—Ç–æ–∫ –∑–∞–Ω—è—Ç–∏–π: ${c.totalLessons - c.attendance.length}</span></div>
        <p><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</b> ${c.comment||"‚Äî"}</p>
        <div class="progress"><div style="width:${progressPercent}%"></div></div>
        <h4>–ó–∞–¥–∞–Ω–∏—è</h4>
        ${c.tasks.map(t=>`<div>${t.done?"‚úÖ":"‚ùå"} ${t.text}</div>`).join("")}
        <h4>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h4>
        ${c.attendance.length>0?c.attendance.join(", "):"‚Äî"}
      </div>`;
  });
  a.innerHTML+="<button class='role-btn' onclick='back()'>–ù–∞–∑–∞–¥</button>";
  a.classList.remove("hidden");
}

save();
</script>
</body>
</html>
